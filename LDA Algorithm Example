{"cells":[{"source":"<a href=\"https://www.kaggle.com/code/gsaimadhav/lda-algorithm-example?scriptVersionId=189607018\" target=\"_blank\"><img align=\"left\" alt=\"Kaggle\" title=\"Open in Kaggle\" src=\"https://kaggle.com/static/images/open-in-kaggle.svg\"></a>","metadata":{},"cell_type":"markdown"},{"cell_type":"markdown","id":"b4e4acd4","metadata":{"papermill":{"duration":0.009788,"end_time":"2024-07-24T14:36:04.414638","exception":false,"start_time":"2024-07-24T14:36:04.40485","status":"completed"},"tags":[]},"source":["This project is to understand the \"Topic Modeling\" concept with LDA(Latent Dirichlet Allocation) algorithm.This algorithm is used to classify text in a document to a particular topic."]},{"cell_type":"code","execution_count":1,"id":"ec13a487","metadata":{"_cell_guid":"b1076dfc-b9ad-4769-8c92-a6c4dae69d19","_uuid":"8f2839f25d086af736a60e9eeb907d3b93b6e0e5","execution":{"iopub.execute_input":"2024-07-24T14:36:04.43384Z","iopub.status.busy":"2024-07-24T14:36:04.433441Z","iopub.status.idle":"2024-07-24T14:36:21.336492Z","shell.execute_reply":"2024-07-24T14:36:21.335451Z"},"papermill":{"duration":16.915517,"end_time":"2024-07-24T14:36:21.33916","exception":false,"start_time":"2024-07-24T14:36:04.423643","status":"completed"},"tags":[]},"outputs":[],"source":["#import required libraries.\n","import os\n","import re\n","import numpy as np \n","import pandas as pd \n","import json\n","from pprint import pprint\n","import random\n","import string \n","\n","#To split the text into tokens or words.\n","from nltk import word_tokenize\n","\n","#Stopwords are --> 'a','the'...etc\n","from nltk.corpus import stopwords\n","\n","#maps words in document to unique integer IDs.\n","from gensim.corpora import Dictionary\n","\n","pd.set_option('display.max_rows', 100)\n","pd.set_option('display.max_columns', 100)\n","pd.set_option('display.max_colwidth', 100)\n"]},{"cell_type":"code","execution_count":2,"id":"db64ec5c","metadata":{"execution":{"iopub.execute_input":"2024-07-24T14:36:21.359134Z","iopub.status.busy":"2024-07-24T14:36:21.357783Z","iopub.status.idle":"2024-07-24T14:36:26.645116Z","shell.execute_reply":"2024-07-24T14:36:26.643757Z"},"papermill":{"duration":5.300177,"end_time":"2024-07-24T14:36:26.647949","exception":false,"start_time":"2024-07-24T14:36:21.347772","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["Number of documents : 401214\n"]}],"source":["documents_dir='../input/CORD-19-research-challenge/document_parses/pdf_json/'\n","filenames = os.listdir(documents_dir)\n","print(\"Number of documents :\", len(filenames))"]},{"cell_type":"code","execution_count":3,"id":"a2066105","metadata":{"execution":{"iopub.execute_input":"2024-07-24T14:36:26.667844Z","iopub.status.busy":"2024-07-24T14:36:26.667456Z","iopub.status.idle":"2024-07-24T14:36:27.109809Z","shell.execute_reply":"2024-07-24T14:36:27.108508Z"},"papermill":{"duration":0.45587,"end_time":"2024-07-24T14:36:27.112895","exception":false,"start_time":"2024-07-24T14:36:26.657025","status":"completed"},"tags":[]},"outputs":[],"source":["random.shuffle(filenames)"]},{"cell_type":"code","execution_count":4,"id":"e0b1b73f","metadata":{"execution":{"iopub.execute_input":"2024-07-24T14:36:27.13237Z","iopub.status.busy":"2024-07-24T14:36:27.131956Z","iopub.status.idle":"2024-07-24T14:36:27.142091Z","shell.execute_reply":"2024-07-24T14:36:27.140994Z"},"papermill":{"duration":0.022869,"end_time":"2024-07-24T14:36:27.144645","exception":false,"start_time":"2024-07-24T14:36:27.121776","status":"completed"},"tags":[]},"outputs":[],"source":["file = json.load(open('../input/CORD-19-research-challenge/document_parses/pdf_json/0000028b5cc154f68b8a269f6578f21e31f62977.json', 'rb'))"]},{"cell_type":"code","execution_count":5,"id":"4eaf561b","metadata":{"execution":{"iopub.execute_input":"2024-07-24T14:36:27.164982Z","iopub.status.busy":"2024-07-24T14:36:27.164501Z","iopub.status.idle":"2024-07-24T14:36:27.170794Z","shell.execute_reply":"2024-07-24T14:36:27.169582Z"},"papermill":{"duration":0.020243,"end_time":"2024-07-24T14:36:27.173652","exception":false,"start_time":"2024-07-24T14:36:27.153409","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["'\"Multi-faceted\" COVID-19: Russian experience'\n"]}],"source":["pprint(file[\"metadata\"][\"title\"])"]},{"cell_type":"markdown","id":"8b940ddb","metadata":{"papermill":{"duration":0.008681,"end_time":"2024-07-24T14:36:27.191095","exception":false,"start_time":"2024-07-24T14:36:27.182414","status":"completed"},"tags":[]},"source":["**Step 1 : Data Cleaning**"]},{"cell_type":"code","execution_count":6,"id":"90973656","metadata":{"execution":{"iopub.execute_input":"2024-07-24T14:36:27.210345Z","iopub.status.busy":"2024-07-24T14:36:27.209942Z","iopub.status.idle":"2024-07-24T14:36:27.231109Z","shell.execute_reply":"2024-07-24T14:36:27.229898Z"},"papermill":{"duration":0.033713,"end_time":"2024-07-24T14:36:27.233474","exception":false,"start_time":"2024-07-24T14:36:27.199761","status":"completed"},"tags":[]},"outputs":[],"source":["#function to clean(preprocess) the text\n","def clean(text):\n","    text = str(text).lower()\n","    #To remove '[] brackets'.\n","    text = re.sub(r'\\[.*?\\]', '', text)\n","    #To remove '() paranthesis'.\n","    text = re.sub(r'\\(.*?\\)', '', text)\n","    #To remove 'empty spaces 1 or more than'.\n","    text = re.sub(r\"\\s+\", \" \", text)\n","    #To remove 'alphanumeric and digits'\n","    text = re.sub(r'\\w*\\d\\w*', '', text)\n","    #To remove ellipsis(which are '...')\n","    text = re.sub(r\"\\w+…|…\", \"\", text) \n","    text = re.sub(f\"[{re.escape(string.punctuation)}]\", \"\", text)\n","    return text\n","\n","\n"]},{"cell_type":"code","execution_count":7,"id":"fafadfe2","metadata":{"execution":{"iopub.execute_input":"2024-07-24T14:36:27.252863Z","iopub.status.busy":"2024-07-24T14:36:27.252461Z","iopub.status.idle":"2024-07-24T14:36:27.259472Z","shell.execute_reply":"2024-07-24T14:36:27.258312Z"},"papermill":{"duration":0.019457,"end_time":"2024-07-24T14:36:27.261889","exception":false,"start_time":"2024-07-24T14:36:27.242432","status":"completed"},"tags":[]},"outputs":[],"source":["#Function to remove and tokenize the text.\n","def remove_stopwords_and_tokenize(text):\n","    my_stopwords = set(stopwords.words(\"english\"))\n","    tokens = word_tokenize(text)  # tokenize \n","    tokens = [t for t in tokens if not t in my_stopwords]  # Remove stopwords\n","    tokens = [t for t in tokens if len(t) > 1]  # Remove short tokens\n","    return tokens\n"]},{"cell_type":"code","execution_count":8,"id":"dfda4b5b","metadata":{"execution":{"iopub.execute_input":"2024-07-24T14:36:27.281385Z","iopub.status.busy":"2024-07-24T14:36:27.280986Z","iopub.status.idle":"2024-07-24T14:36:27.287021Z","shell.execute_reply":"2024-07-24T14:36:27.28599Z"},"papermill":{"duration":0.019,"end_time":"2024-07-24T14:36:27.289728","exception":false,"start_time":"2024-07-24T14:36:27.270728","status":"completed"},"tags":[]},"outputs":[],"source":["#parsing the text\n","def parse_body_text(body_text):\n","    body =\"\"\n","    for item in body_text:\n","        body += item[\"section\"]\n","        body += \"\\n\\n\"\n","        body += item[\"text\"]\n","        body += \"\\n\\n\"\n","    body=clean(body)\n","    tokens=remove_stopwords_and_tokenize(body)\n","    return body,tokens\n"]},{"cell_type":"code","execution_count":9,"id":"2fd0b5fb","metadata":{"execution":{"iopub.execute_input":"2024-07-24T14:36:27.308877Z","iopub.status.busy":"2024-07-24T14:36:27.308465Z","iopub.status.idle":"2024-07-24T14:37:30.296929Z","shell.execute_reply":"2024-07-24T14:37:30.29573Z"},"papermill":{"duration":63.001659,"end_time":"2024-07-24T14:37:30.300097","exception":false,"start_time":"2024-07-24T14:36:27.298438","status":"completed"},"tags":[]},"outputs":[],"source":["all_text = []\n","all_tokens=[]\n","all_titles=[]\n","for i,filename in enumerate(filenames[:1000]):\n","    filepath = documents_dir + filename\n","    file = json.load(open(filepath, 'rb'))\n","    text,tokens=parse_body_text(file[\"body_text\"])\n","    all_text.append(text)\n","    all_tokens.append(tokens)\n","    all_titles.append(file[\"metadata\"][\"title\"])\n","    "]},{"cell_type":"code","execution_count":10,"id":"2869e44a","metadata":{"execution":{"iopub.execute_input":"2024-07-24T14:37:30.320858Z","iopub.status.busy":"2024-07-24T14:37:30.320441Z","iopub.status.idle":"2024-07-24T14:37:30.344169Z","shell.execute_reply":"2024-07-24T14:37:30.342803Z"},"papermill":{"duration":0.036432,"end_time":"2024-07-24T14:37:30.346786","exception":false,"start_time":"2024-07-24T14:37:30.310354","status":"completed"},"tags":[]},"outputs":[{"name":"stdout","output_type":"stream","text":["Tokens are populated correctly!\n"]}],"source":["#Arranging the extracted data in Dataframe\n","data = pd.DataFrame()\n","data['text'] = all_text\n","data['tokens'] = all_tokens\n","data['doc_id'] = filenames[:1000]\n","data['title'] = all_titles\n","del all_text,all_tokens,all_titles\n","\n","if not data['tokens'].empty and all(data['tokens']):\n","    print(\"Tokens are populated correctly!\")\n","else:\n","    print(\"Tokens are empty!!\")"]},{"cell_type":"code","execution_count":11,"id":"93c44897","metadata":{"execution":{"iopub.execute_input":"2024-07-24T14:37:30.366431Z","iopub.status.busy":"2024-07-24T14:37:30.365724Z","iopub.status.idle":"2024-07-24T14:37:30.38683Z","shell.execute_reply":"2024-07-24T14:37:30.385738Z"},"papermill":{"duration":0.033938,"end_time":"2024-07-24T14:37:30.389533","exception":false,"start_time":"2024-07-24T14:37:30.355595","status":"completed"},"tags":[]},"outputs":[{"data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>text</th>\n","      <th>tokens</th>\n","      <th>doc_id</th>\n","      <th>title</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>the centers for disease control and prevention estimates that about  to  children experience up...</td>\n","      <td>[centers, disease, control, prevention, estimates, children, experience, upperlimb, reduction, d...</td>\n","      <td>111236182bc6ad46a55da6f6adedd9bc990b0a8f.json</td>\n","      <td>Home intervention for children and adolescents with unilateral trans-radial and partial carpal r...</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>introduction in december  wuhan china witnessed a mysterious cluster outbreak of pneumonia which...</td>\n","      <td>[introduction, december, wuhan, china, witnessed, mysterious, cluster, outbreak, pneumonia, dece...</td>\n","      <td>ede1f9339afe2a20198c18f5f4542804a8740dae.json</td>\n","      <td>COVID-19: Current Knowledge and Best Practices for Orthopaedic Surgeons</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["                                                                                                  text  \\\n","0   the centers for disease control and prevention estimates that about  to  children experience up...   \n","1  introduction in december  wuhan china witnessed a mysterious cluster outbreak of pneumonia which...   \n","\n","                                                                                                tokens  \\\n","0  [centers, disease, control, prevention, estimates, children, experience, upperlimb, reduction, d...   \n","1  [introduction, december, wuhan, china, witnessed, mysterious, cluster, outbreak, pneumonia, dece...   \n","\n","                                          doc_id  \\\n","0  111236182bc6ad46a55da6f6adedd9bc990b0a8f.json   \n","1  ede1f9339afe2a20198c18f5f4542804a8740dae.json   \n","\n","                                                                                                 title  \n","0  Home intervention for children and adolescents with unilateral trans-radial and partial carpal r...  \n","1                              COVID-19: Current Knowledge and Best Practices for Orthopaedic Surgeons  "]},"execution_count":11,"metadata":{},"output_type":"execute_result"}],"source":["data.head(2)"]},{"cell_type":"markdown","id":"395f19e7","metadata":{"papermill":{"duration":0.008702,"end_time":"2024-07-24T14:37:30.407571","exception":false,"start_time":"2024-07-24T14:37:30.398869","status":"completed"},"tags":[]},"source":["**Step 2 : Apply LDA model**"]},{"cell_type":"code","execution_count":12,"id":"d25b2401","metadata":{"execution":{"iopub.execute_input":"2024-07-24T14:37:30.428006Z","iopub.status.busy":"2024-07-24T14:37:30.426909Z","iopub.status.idle":"2024-07-24T14:37:33.188783Z","shell.execute_reply":"2024-07-24T14:37:33.187805Z"},"papermill":{"duration":2.77487,"end_time":"2024-07-24T14:37:33.191446","exception":false,"start_time":"2024-07-24T14:37:30.416576","status":"completed"},"tags":[]},"outputs":[],"source":["#creating a dictionary representation of the documents\n","dictionary = Dictionary(data[\"tokens\"])\n","\n","#Filter out the words that occur less than 20 documents, or than 50% of the documents.\n","dictionary.filter_extremes(no_below = 20, no_above = 0.5)"]},{"cell_type":"code","execution_count":13,"id":"b265943d","metadata":{"execution":{"iopub.execute_input":"2024-07-24T14:37:33.211818Z","iopub.status.busy":"2024-07-24T14:37:33.211005Z","iopub.status.idle":"2024-07-24T14:37:34.331414Z","shell.execute_reply":"2024-07-24T14:37:34.330374Z"},"papermill":{"duration":1.133395,"end_time":"2024-07-24T14:37:34.334104","exception":false,"start_time":"2024-07-24T14:37:33.200709","status":"completed"},"tags":[]},"outputs":[],"source":["#Bag-of-words reperesentation of the documents.\n","corpus = [dictionary.doc2bow(doc) for doc in data[\"tokens\"]]"]},{"cell_type":"code","execution_count":14,"id":"f4e25fb0","metadata":{"execution":{"iopub.execute_input":"2024-07-24T14:37:34.354262Z","iopub.status.busy":"2024-07-24T14:37:34.353842Z","iopub.status.idle":"2024-07-24T14:47:30.827811Z","shell.execute_reply":"2024-07-24T14:47:30.8262Z"},"papermill":{"duration":596.489288,"end_time":"2024-07-24T14:47:30.832515","exception":false,"start_time":"2024-07-24T14:37:34.343227","status":"completed"},"tags":[]},"outputs":[],"source":["from gensim.models import LdaModel\n","\n","#Build a LDA Model\n","lda_model = LdaModel(corpus = corpus,id2word=dictionary,num_topics=20,random_state=100,chunksize=200,passes=100)"]},{"cell_type":"code","execution_count":15,"id":"c3530e72","metadata":{"execution":{"iopub.execute_input":"2024-07-24T14:47:30.873797Z","iopub.status.busy":"2024-07-24T14:47:30.873148Z","iopub.status.idle":"2024-07-24T14:47:30.899125Z","shell.execute_reply":"2024-07-24T14:47:30.897533Z"},"papermill":{"duration":0.052025,"end_time":"2024-07-24T14:47:30.904068","exception":false,"start_time":"2024-07-24T14:47:30.852043","status":"completed"},"tags":[]},"outputs":[{"data":{"text/plain":["[(0,\n","  '0.011*\"intervention\" + 0.010*\"participants\" + 0.009*\"treatment\" + 0.008*\"interventions\" + 0.007*\"methods\" + 0.007*\"review\" + 0.006*\"quality\" + 0.006*\"trial\" + 0.005*\"outcomes\" + 0.005*\"symptoms\"'),\n"," (1,\n","  '0.012*\"severe\" + 0.011*\"treatment\" + 0.010*\"mortality\" + 0.009*\"sarscov\" + 0.008*\"respiratory\" + 0.007*\"patient\" + 0.007*\"outcomes\" + 0.007*\"age\" + 0.006*\"hospital\" + 0.006*\"children\"'),\n"," (2,\n","  '0.007*\"social\" + 0.007*\"people\" + 0.006*\"public\" + 0.005*\"community\" + 0.004*\"local\" + 0.004*\"resources\" + 0.004*\"state\" + 0.004*\"change\" + 0.003*\"development\" + 0.003*\"challenges\"'),\n"," (3,\n","  '0.039*\"cells\" + 0.019*\"expression\" + 0.018*\"cell\" + 0.011*\"immune\" + 0.010*\"il\" + 0.008*\"genes\" + 0.008*\"mice\" + 0.008*\"activation\" + 0.007*\"human\" + 0.006*\"inflammatory\"'),\n"," (4,\n","  '0.053*\"vaccine\" + 0.043*\"vaccination\" + 0.037*\"antibodies\" + 0.035*\"sarscov\" + 0.032*\"vaccines\" + 0.031*\"antibody\" + 0.018*\"igg\" + 0.013*\"immune\" + 0.012*\"responses\" + 0.012*\"neutralizing\"')]"]},"execution_count":15,"metadata":{},"output_type":"execute_result"}],"source":["#displaying topics that have been identified by LDA Algorithm.\n","lda_model.print_topics()[:5]\n","#Each word is assigned with a probability in a topic(This probability defines the importance of the word).\n","#'index' --> defines the topic."]},{"cell_type":"code","execution_count":16,"id":"80cc01cc","metadata":{"execution":{"iopub.execute_input":"2024-07-24T14:47:30.92738Z","iopub.status.busy":"2024-07-24T14:47:30.927Z","iopub.status.idle":"2024-07-24T14:47:30.940779Z","shell.execute_reply":"2024-07-24T14:47:30.939376Z"},"papermill":{"duration":0.027685,"end_time":"2024-07-24T14:47:30.943963","exception":false,"start_time":"2024-07-24T14:47:30.916278","status":"completed"},"tags":[]},"outputs":[{"data":{"text/plain":["[(0, 0.5458214),\n"," (1, 0.030365366),\n"," (2, 0.013864052),\n"," (5, 0.032903872),\n"," (6, 0.20941629),\n"," (7, 0.03486312),\n"," (8, 0.027310738),\n"," (9, 0.078208774),\n"," (15, 0.013472595)]"]},"execution_count":16,"metadata":{},"output_type":"execute_result"}],"source":["#Topic distributions for the first document.\n","lda_model[corpus][0]"]},{"cell_type":"markdown","id":"50df0cac","metadata":{"papermill":{"duration":0.01886,"end_time":"2024-07-24T14:47:30.982458","exception":false,"start_time":"2024-07-24T14:47:30.963598","status":"completed"},"tags":[]},"source":["**Step 4 : Results**"]},{"cell_type":"code","execution_count":17,"id":"88020182","metadata":{"execution":{"iopub.execute_input":"2024-07-24T14:47:31.023776Z","iopub.status.busy":"2024-07-24T14:47:31.023045Z","iopub.status.idle":"2024-07-24T14:47:37.32132Z","shell.execute_reply":"2024-07-24T14:47:37.319555Z"},"papermill":{"duration":6.323894,"end_time":"2024-07-24T14:47:37.325701","exception":false,"start_time":"2024-07-24T14:47:31.001807","status":"completed"},"tags":[]},"outputs":[],"source":["#Document - Topic Table\n","def get_document_topic_table(lda_model, corpus, texts=data):\n","    #Init output\n","    document_topic_df = pd.DataFrame()\n","    \n","    #Get main topic in each documet\n","    for i,row_list in enumerate(lda_model[corpus]):\n","        row = sorted(row_list, key=lambda x: (x[1]), reverse=True)\n","        topic_num = row[0][0]\n","        prop_topic = row[0][1]\n","        wp = lda_model.show_topic(topic_num)\n","        topic_keywords = \", \".join([word for word, prop in wp])\n","        document_topic_df.at[i,'best_topic'] = topic_num\n","        document_topic_df.at[i,'prop_topic'] = prop_topic\n","        document_topic_df.at[i,'topic_keyboards'] = topic_keywords\n","        document_topic_df.at[i,'document_num'] = i\n","    return document_topic_df\n","\n","document_topic_df = get_document_topic_table(lda_model=lda_model, corpus=corpus, texts=data[\"tokens\"])"]},{"cell_type":"code","execution_count":18,"id":"db3a354a","metadata":{"execution":{"iopub.execute_input":"2024-07-24T14:47:37.367131Z","iopub.status.busy":"2024-07-24T14:47:37.366414Z","iopub.status.idle":"2024-07-24T14:47:37.39767Z","shell.execute_reply":"2024-07-24T14:47:37.396158Z"},"papermill":{"duration":0.056919,"end_time":"2024-07-24T14:47:37.40243","exception":false,"start_time":"2024-07-24T14:47:37.345511","status":"completed"},"tags":[]},"outputs":[{"data":{"text/html":["<div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>best_topic</th>\n","      <th>prop_topic</th>\n","      <th>topic_keyboards</th>\n","      <th>document_num</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>0.0</td>\n","      <td>0.545820</td>\n","      <td>intervention, participants, treatment, interventions, methods, review, quality, trial, outcomes,...</td>\n","      <td>0.0</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>8.0</td>\n","      <td>0.297293</td>\n","      <td>care, patient, medical, staff, healthcare, services, hospital, nurses, service, nurse</td>\n","      <td>1.0</td>\n","    </tr>\n","  </tbody>\n","</table>\n","</div>"],"text/plain":["   best_topic  prop_topic  \\\n","0         0.0    0.545820   \n","1         8.0    0.297293   \n","\n","                                                                                       topic_keyboards  \\\n","0  intervention, participants, treatment, interventions, methods, review, quality, trial, outcomes,...   \n","1                care, patient, medical, staff, healthcare, services, hospital, nurses, service, nurse   \n","\n","   document_num  \n","0           0.0  \n","1           1.0  "]},"execution_count":18,"metadata":{},"output_type":"execute_result"}],"source":["document_topic_df.head(2)"]},{"cell_type":"markdown","id":"84c67470","metadata":{"papermill":{"duration":0.015757,"end_time":"2024-07-24T14:47:37.439274","exception":false,"start_time":"2024-07-24T14:47:37.423517","status":"completed"},"tags":[]},"source":["**Recommend 'k' Topics**"]},{"cell_type":"code","execution_count":19,"id":"fcfa0db1","metadata":{"execution":{"iopub.execute_input":"2024-07-24T14:47:37.461514Z","iopub.status.busy":"2024-07-24T14:47:37.460397Z","iopub.status.idle":"2024-07-24T14:47:37.537298Z","shell.execute_reply":"2024-07-24T14:47:37.535994Z"},"papermill":{"duration":0.091148,"end_time":"2024-07-24T14:47:37.540114","exception":false,"start_time":"2024-07-24T14:47:37.448966","status":"completed"},"tags":[]},"outputs":[],"source":["def get_topic_id(doc_id):\n","    for i,row in data.iterrows():\n","        if(row[\"doc_id\"]==doc_id):\n","            #print(document_topic_df[\"best_topic\"][i])\n","            return document_topic_df[\"best_topic\"][i]\n","    return -1\n","\n","def get_matching_topics_docs(topic_id):\n","    matched_topics=[]\n","    for i,row in document_topic_df.iterrows():\n","        \n","        if(row[\"best_topic\"]==topic_id):\n","            topic_prop_doc=(topic_id,row[\"prop_topic\"],i)\n","            matched_topics.append(topic_prop_doc)\n","        \n","    return matched_topics\n","    \n","def get_top_k_topics(matched_topics,k):\n","    top_k=sorted(matched_topics, key=lambda x: [x[1]], reverse=True)\n","    print(top_k[:k])\n","    k_topics_df=pd.DataFrame(columns=[\"doc_id\",\"topic_id\",\"topic_prop\",\"title\"])\n","    i=0\n","    for topic_id,topic_prop,doc_num in top_k[:k]:\n","        k_topics_df.at[i,'doc_id']=data[\"doc_id\"][doc_num]\n","        k_topics_df.at[i,'topic_id']=topic_id\n","        k_topics_df.at[i,'topic_prop']=topic_prop\n","        k_topics_df.at[i,'title']=data[\"title\"][doc_num]\n","        i+=1\n","    return k_topics_df\n","\n","def recommend_k_topics(doc_id,k):\n","    topic_id=get_topic_id(doc_id)\n","    if(topic_id!=-1):\n","        matched_topics=get_matching_topics_docs(topic_id) \n","        return get_top_k_topics(matched_topics,k)\n","    \n","    \n","k_topics_df=recommend_k_topics('328401206bf2e3657e352ad5c5a2e566cc09736d.json',5)"]},{"cell_type":"code","execution_count":20,"id":"9364b727","metadata":{"execution":{"iopub.execute_input":"2024-07-24T14:47:37.561421Z","iopub.status.busy":"2024-07-24T14:47:37.561022Z","iopub.status.idle":"2024-07-24T14:47:37.566024Z","shell.execute_reply":"2024-07-24T14:47:37.565005Z"},"papermill":{"duration":0.018613,"end_time":"2024-07-24T14:47:37.568458","exception":false,"start_time":"2024-07-24T14:47:37.549845","status":"completed"},"tags":[]},"outputs":[],"source":["k_topics_df"]},{"cell_type":"code","execution_count":null,"id":"8e77eff0","metadata":{"papermill":{"duration":0.009348,"end_time":"2024-07-24T14:47:37.58754","exception":false,"start_time":"2024-07-24T14:47:37.578192","status":"completed"},"tags":[]},"outputs":[],"source":[]}],"metadata":{"kaggle":{"accelerator":"none","dataSources":[{"datasetId":551982,"sourceId":3756201,"sourceType":"datasetVersion"}],"dockerImageVersionId":30746,"isGpuEnabled":false,"isInternetEnabled":true,"language":"python","sourceType":"notebook"},"kernelspec":{"display_name":"Python 3","language":"python","name":"python3"},"language_info":{"codemirror_mode":{"name":"ipython","version":3},"file_extension":".py","mimetype":"text/x-python","name":"python","nbconvert_exporter":"python","pygments_lexer":"ipython3","version":"3.10.13"},"papermill":{"default_parameters":{},"duration":697.47611,"end_time":"2024-07-24T14:47:38.823787","environment_variables":{},"exception":null,"input_path":"__notebook__.ipynb","output_path":"__notebook__.ipynb","parameters":{},"start_time":"2024-07-24T14:36:01.347677","version":"2.5.0"}},"nbformat":4,"nbformat_minor":5}